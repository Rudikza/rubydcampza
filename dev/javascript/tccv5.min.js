$("[data-translate]").jqTranslate('index' , {
  asyncLangLoad: true,
  fallbackLang: 'en',
  path: 'locale',
  cache: true
});

document.documentElement.setAttribute('data-ua', navigator.userAgent);

function isScrolledIntoView(elem) {
  if ($(elem).length === 0) {
    return false;
  }
  var docViewTop = $(window).scrollTop();
  var docViewBottom = docViewTop + $(window).height();

  var elemTop = $(elem).offset().top;
  var elemBottom = elemTop + $(elem).height();
  return (docViewBottom >= elemTop && docViewTop <= elemBottom);
}

var dom = {
  siteLoader: $('.loader-wrapper'),
  intro: $('.intro'),
  uspFeature: $('.usp__feature'),
  processSketch: $('.process__sketch'),
  car: $('.car'),
  introH1: $('.intro__header h1'),
  introH1Span: $('.intro__header h1 span.load'),
  introH2: $('.intro__header h2'),
  formErrorEmpty: $('.form__error:empty'),
  workMore: $('a.work__more'),
  workGroupFirst: $('.work .group:first-of-type'),
  workGroupShown: $('.work .group.shown'),
  workGroupImg: $('.work .group.shown img')
};

dom.formErrorEmpty.remove();

uspFeatureView = function() {
  if ( isScrolledIntoView(dom.uspFeature) ) {
    dom.uspFeature.addClass('appear');
  } else {
    return;
  }
};

processSketchView = function() {
  if ( isScrolledIntoView(dom.processSketch) ) {
    dom.processSketch.addClass('appear');
  } else {
    return;
  }
};

workView = function() {
  if ( isScrolledIntoView(dom.workGroupFirst) ) {
    dom.workGroupFirst.removeClass('disappear');
  } else {
    return;
  }
};

$.fn.nextOrFirst = function(selector) {
var next = this.next(selector);
return (next.length) ? next : this.prevAll(selector).last();
};

$.fn.prevOrLast = function(selector) {
var prev = this.prev(selector);
return (prev.length) ? prev : this.nextAll(selector).last();
};

$(document).ready(function() {

  $(window).on('scroll', function () {
    uspFeatureView();
    processSketchView();
    workView();
  });

  uspFeatureView();
  processSketchView();
  workView();

  $('#language').click(function () {
    if ( $(this).hasClass('german') ) {
      $("[data-translate]").jqTranslate('index', { path: 'locale', forceLang: 'de' });
    } else {
      $("[data-translate]").jqTranslate('index', { path: 'locale', forceLang: 'en' });
    }
  });


  $('.carImage').load(function() {
    // short timeout for the loader
    setTimeout(function () {
      // remove loader html
      dom.siteLoader.remove();
      // show intro area
      dom.intro.addClass('show');
      dom.introH1.addClass('show');
      // show intro__header loader
      dom.introH1Span.addClass('loader').one('webkitAnimationEnd mozAnimationEnd oAnimationEnd msAnimationEnd animationend', function(){
        // when the animation has played, remove intro__header loader and show car area
        $(this).remove();
        dom.car.addClass('show').one('webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionend', function(){
          // when the car area is zoomed in, zoom in the intro__header_h2
          dom.introH2.addClass('show');
        });
      });
    }, 100);
  });




  // show images of the first work group
  dom.workMore.click(function () {


    $('.work .group.shown').addClass('disappear').one('webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionend', function(){
      $(this).removeClass('shown').addClass('hidden').nextOrFirst().addClass('shown').removeClass('hidden');
      setTimeout(function () {
        $('.work .group.shown').removeClass('disappear');
      },50);
    });

  });



  dom.introH1.click(function (e) {
    e.preventDefault();
    dom.introH1Span.remove();
    dom.car.toggleClass('show').one('webkitTransitionEnd mozTransitionEnd oTransitionEnd msTransitionEnd transitionend', function(){
      dom.introH2.addClass('zoomIn');
    });
  });

  // Google Maps API v3
  function initialize() {
    var mapOptions = {
      center: new google.maps.LatLng(50.938643, 6.9524722),
      zoom: 14,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    new google.maps.Map(document.getElementById("map-canvas"),
    mapOptions);
  }
  google.maps.event.addDomListener(window, 'load', initialize);

});
